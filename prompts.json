{
  "stage1_text_generation_single_page": {
    "system_message": "You are an expert children's book author and illustrator assistant. Your task is to generate the content for a specific page of a picture book, based on character descriptions, a story outline, and the current page number within a {total_pages}-page structure.",
    "user_prompt_template": "**Input:**\n\n*   **Characters:**\n    ```json\n    {characters_json}\n    ```\n*   **Story Outline:**\n    \"{story_outline}\"\n*   **Total Pages:** {total_pages}\n*   **Current Page Number:** {page_number}\n\n**Instructions:**\n\n1.  **Determine Page Content:** Based on the overall story outline and the current page number ({page_number} out of {total_pages}), determine the appropriate scene and text for this specific page. Ensure the story progresses logically from the previous page context (if provided in history).\n2.  **Scene Description:** Write a vivid and detailed visual description of the scene for page {page_number}. Clearly state which characters are present and what they are doing, incorporating details from their provided descriptions. Describe the setting and mood.\n3.  **Page Text:** Write simple, engaging text for page {page_number}, appropriate for a 5-year-old. The text MUST rhyme and be written in the distinct, playful, and rhythmic style of Dr. Seuss. It should complement the scene description and be relatively short (1-4 lines).\n4.  **Output Format:** Your entire response must be ONLY a single, valid JSON object with the keys \"page_number\" (integer, matching the input {page_number}), \"scene_description\" (string), and \"page_text\" (string). Do not include any introductory text, explanations, markdown formatting, or anything else outside the single JSON object structure.\n\n**Example Output Format:**\n\n```json\n{{\n  \"page_number\": {page_number},\n  \"scene_description\": \"Detailed visual description for this page...\",\n  \"page_text\": \"Simple text for this page...\"\n}}\n```\n\n**Generate the content ONLY for page {page_number} now.**\n"
  },
  "stage1_text_generation_narrative_page": {
    "system_message": "You are an expert scriptwriter and author assistant. Your task is to generate the content for a specific page of a narrative story (like a comic book or graphic novel), based on character descriptions, a story outline, and the current page number within a {total_pages}-page structure.",
    "user_prompt_template": "**Input:**\n\n*   **Characters:**\n    ```json\n    {characters_json}\n    ```\n*   **Story Outline:**\n    \"{story_outline}\"\n*   **Total Pages:** {total_pages}\n*   **Current Page Number:** {page_number}\n\n**Instructions:**\n\n1.  **Determine Page Content:** Based on the overall story outline and the current page number ({page_number} out of {total_pages}), determine the appropriate scene and script elements for this specific page. Ensure the story progresses logically from the previous page context (if provided in history).\n2.  **Scene Description:** Write a vivid and detailed visual description of the scene for page {page_number}. Clearly state which characters are present and what they are doing, incorporating details from their provided descriptions. Describe the setting and mood.\n3.  **Script Text:** Write the script for page {page_number}. Include narration and dialogue as appropriate for the scene. Use standard script formatting:\n    *   Narration lines should start with `NARRATOR:`.\n    *   Dialogue lines should start with the character's name in uppercase, followed by a colon (e.g., `CHARACTER_NAME:`).\n    *   Keep the text concise and impactful, suitable for rendering in narration boxes or speech bubbles.\n4.  **Output Format:** Your entire response must be ONLY a single, valid JSON object with the keys \"page_number\" (integer, matching the input {page_number}), \"scene_description\" (string), and \"script_text\" (string containing the narration and dialogue). Do not include any introductory text, explanations, markdown formatting, or anything else outside the single JSON object structure.\n\n**Example Output Format:**\n\n```json\n{{\n  \"page_number\": {page_number},\n  \"scene_description\": \"Detailed visual description for this page...\",\n  \"script_text\": \"NARRATOR: The city slept, unaware of the danger lurking.\\nCHARACTER_A: Did you hear that?\\nCHARACTER_B: Just the wind... I hope.\"\n}}\n```\n\n**Generate the content ONLY for page {page_number} now.**\n"
  },
  "stage2_image_childrens": {
    "prompt_template": "\nA children's book illustration in a dreamy children's book style.\n\nScene Description: {scene_description}\n\nCharacters present:\n{character_details_string}\n\nClearly render the following text within the illustration, using a simple, clear children's book style font: \"{page_text}\"\n\nEnsure the illustration is safe, wholesome, and clearly appropriate for a young children's book audience, avoiding any potentially sensitive or ambiguous interpretations.\nEnsure a full view, uncropped image. Make sure all requested text is fully visible and not cut off.\nEnsure a full view, uncropped image.\nMake sure all requested text is fully visible and not cut off.\n"
  },
  "stage2_image_dark_anime": {
    "prompt_template": "A full comic book page rendered in a dark, gritty, atmospheric manga style, reminiscent of works like Berserk or Tokyo Ghoul, with strong linework, high contrast, and detailed shading. The page should depict the following scene, broken down into multiple distinct panels with clear gutters:\n\nScene Description: {scene_description}\n\nCharacters potentially present (use for visual reference):\n{character_details_string}\n\nParse the following script text and render it within the illustration using appropriate narration boxes (for 'NARRATOR:') and speech bubbles (for character dialogue, associated with characters present), using a gritty, hand-drawn comic book font:\nScript Text:\n{script_text}\n\nInstructions:\n1. Create a dynamic multi-panel layout appropriate for a manga/comic book page.\n2. Illustrate the scene described above across the panels, maintaining the specified dark manga art style.\n3. Place the parsed narration and dialogue text within appropriate boxes/bubbles, ensuring legibility and correct association with characters.\n4. Maintain a serious, potentially intense or action-oriented tone consistent with dark manga.\n5. Ensure the illustration avoids overly explicit content but maintains a mature, dark tone.\n6. Ensure a full view, uncropped image. Make sure panel borders and rendered text are fully visible.\nEnsure a full view, uncropped image.\nMake sure panel borders and rendered text are fully visible.\n"
  },
  "stage2_image_dreamy_anime": {
    "prompt_template": "A soft, ethereal, dreamy anime illustration style, with pastel colors and gentle lighting, reminiscent of Studio Ghibli.\n\nScene Description: {scene_description}\n\nCharacters present:\n{character_details_string}\n\nParse the following script text and render it within the illustration using appropriate narration boxes (for 'NARRATOR:') and speech bubbles (for character dialogue, associated with characters present), using a delicate, flowing script font:\nScript Text:\n{script_text}\n\nEnsure the illustration is safe, wholesome, and appropriate for all audiences.\nEnsure a full view, uncropped image.\nMake sure all rendered text is fully visible and not cut off.\n"
  },
  "stage2_image_70s_cartoon": {
    "prompt_template": "A groovy, colorful 1970s Hanna-Barbera style cartoon illustration, with bold lines and flat colors.\n\nScene Description: {scene_description}\n\nCharacters present:\n{character_details_string}\n\nParse the following script text and render it within the illustration using appropriate narration boxes (for 'NARRATOR:') and speech bubbles (for character dialogue, associated with characters present), using a fun, rounded, bubbly 70s-style font:\nScript Text:\n{script_text}\n\nEnsure the illustration is safe, wholesome, and appropriate for a children's cartoon audience.\nEnsure a full view, uncropped image.\nMake sure all rendered text is fully visible and not cut off.\n"
  },
  "cover_image_generation": {
    "prompt_template": "\nA vibrant and eye-catching book cover illustration in a {style_description} style. The cover should feature the main characters and hint at the story's theme.\n\nCharacters to feature prominently:\n{character_details_string}\n\nRender the book title clearly and attractively on the cover using a font appropriate for the {style_description} style: \"{book_title}\"\n\nEnsure the illustration is safe and appropriate for the intended audience.\nEnsure a full view, uncropped image.\nMake sure the book title text is fully visible and not cut off.\n"
  },
  "stage2_image_mgs_comic": {
    "prompt_template": "A full comic book page rendered in the gritty, high-contrast, dynamic ink sketch style of Yoji Shinkawa (Metal Gear Solid). The page should depict the following scene, broken down into multiple distinct panels with clear gutters:\n\nScene Description: {scene_description}\n\nCharacters potentially present (use for visual reference):\n{character_details_string}\n\nParse the following script text and render it within the illustration using appropriate narration boxes (for 'NARRATOR:') and speech bubbles (for character dialogue, associated with characters present), using a font suitable for a gritty comic:\nScript Text:\n{script_text}\n\nInstructions:\n1. Create a dynamic multi-panel layout appropriate for a comic book page.\n2. Illustrate the scene described above across the panels, maintaining the specified art style.\n3. Place the parsed narration and dialogue text within appropriate boxes/bubbles, ensuring legibility and correct association with characters.\n4. Maintain a serious, potentially tense or action-oriented tone consistent with Metal Gear Solid.\n5. **Content Moderation & Safety Emphasis:** Interpret the scene description metaphorically or indirectly where necessary to avoid depicting explicit violence (e.g., weapons firing, blood), gore, or overly intimate situations. Focus on the *implication* of action rather than the action itself. Depict tense moments through character posture, facial expressions, shadows, and environmental cues, not through direct aggression. If the scene involves potential conflict, show the moments *before* or *after*, or use symbolic imagery. Avoid common trigger words in the script text. Focus on tension, stealth, dramatic poses, and environmental storytelling. Hint at conflict or action using visual metaphors or suggestive imagery rather than explicit violence. Prioritize character expressions, body language, and atmospheric lighting to convey the mood. Ensure the overall composition adheres to safety guidelines while maintaining the intended gritty tone.\n6. Ensure the illustration is safe for a mature audience.\n7. Output a full view, uncropped image of the complete comic page. Make sure panel borders and text elements are fully visible.\nEnsure a full view, uncropped image of the complete comic page.\nMake sure panel borders and text elements are fully visible.\n"
  }
}
